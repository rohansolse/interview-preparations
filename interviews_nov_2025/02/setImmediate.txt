ðŸ§  What is setImmediate() in Node.js?

setImmediate() is a Node.js-specific function (not available in browser JavaScript).
It schedules a callback to be executed after the current event loop cycle is completed, 
but before setTimeout(..., 0) in most cases.

When Node.js finishes executing the current synchronous code, 
it places the callback of setImmediate() into the check phase of the event loop.

Because setImmediate() runs before setTimeout(..., 0) in most cases
(note: sometimes depends on system performance & I/O).

ðŸ§  What is setImmediate() in Node.js?

setImmediate() is a Node.js-specific function (not available in browser JavaScript).
It schedules a callback to be executed after the current event loop cycle is completed, but before setTimeout(..., 0) in most cases.


âœ”ï¸ Solution with setImmediate()

We split the large work into segments using setImmediate()
âž¡ This allows Node.js to handle other requests in between!
âž¡ Non-blocking and efficient ðŸš€

app.get('/process-data', (req, res) => {
  const largeArray = new Array(100000).fill(0).map((_, i) => i);

  function processChunk(startIndex) {
    for (let i = startIndex; i < startIndex + 1000 && i < largeArray.length; i++) {
      // Heavy processing logic
    }

    if (startIndex < largeArray.length) {
      setImmediate(() => processChunk(startIndex + 1000)); // Continue next chunk
    }
  }

  processChunk(0); // Start processing
  res.send("Started Processing - Server is still responsive!");
});

ðŸ§  Why This Works?

âœ” Breaks work into chunks
âœ” Each chunk runs in Check Phase using setImmediate()
âœ” Event loop remains free for other API calls
âœ” High performance â†’ No blocking


ðŸ“¦ Use Case â€“ Logging After Response

You can send response fast but do heavy logging afterwards â¬‡

app.post('/login', (req, res) => {
  res.send("Login Successful!");

  // Logging AFTER response to keep API fast
  setImmediate(() => {
    saveLoginHistoryToDB(req.body.userId);  // heavy DB task
  });
});

ðŸ“ Use Case â€“ File Upload Processing
app.post('/upload', upload.single('file'), (req, res) => {
  res.send("Upload Received. Processing in background...");

  setImmediate(() => {
    processFile(req.file.path);  // Heavy CPU task
  });
});


ðŸŽ¯ Final Conclusion

âœ” setImmediate() is not for delay, it is for non-blocking task execution
âœ” Helps build scalable & fast Node.js APIs
âœ” Best for I/O heavy & CPU intensive tasks
âœ” Executes after current event loop but before timers